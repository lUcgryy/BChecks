metadata:
    language: v2-beta
    name: "Gogs (Go Git Service) 0.11.66 - Remote Code Execution Detected"
    description: "Gogs 0.11.66 allows remote code execution because it does not properly validate session IDs, as demonstrated by a \"..\" session-file forgery in the file session provider in file.go. This is related to session ID handling in the go-macaron/session code for Macaron."
    author: "lUcgryy"
    tags: "Gogs", "CVE-2018-18925", "cve"
define:
    issueDetail = `CVE-2018-18925 Gogs 0.11.66 - Remote Command Execution Detected`
    issueRemediation = "This issue will be fixed by updating to the latest version of Gogs."
# Should turn off Cookie jar when using this BChecks
given host then
    send request called check1:
        `GET / HTTP/1.1
Host: {latest.request.url.host}
Cookie: i_like_gogits=../../../../etc/passwd; 
Connection: keep-alive

`
    send request called check2:
        `GET / HTTP/1.1
Host: {latest.request.url.host}
Cookie: i_like_gogits=../../../../etc/dummy; 
Connection: keep-alive

`
    if ({check1.response.status_code} is "500") and ({check2.response.status_code} is "200") and (`<meta name="author" content="Gogs" />` in {check2.response.body}) then
        report issue:
            severity: high
            confidence: certain
            detail: `{issueDetail}`
            remediation: `{issueRemediation}`
    end if
