metadata:
    language: v2-beta
    name: "CVE-2015-3224 Ruby on Rails Web Console"
    description: "Tests for the CVE-2015-3224 vulnerability"
    author: "lUcgryy"
    tags: "Ruby", "CVE-2015-3224", "cve"

define:
    payload1 = "::1"
    issueDetail = `Ruby on Rails Web Console before 2.1.3, as used with Ruby on Rails 3.x and 4.x, does not properly restrict the use of X-Forwarded-For headers in determining a client's IP address, which allows remote attackers to bypass the whitelisted_ips protection mechanism via a crafted request to request.rb.`
    issueRemediation = "Upgrade to a patched version of Ruby on Rails or disable the Web Console feature"
given host then
    send request called check:
        method: "GET"
        path: "/force_routing_error"
        appending headers:
            "X-Forwarded-For": `{payload1}`
    if {latest.response} matches "data-remote-path=" then
        report issue:
            severity: high
            confidence: firm
            detail: `{issueDetail}`
            remediation: `{issueRemediation}`
    end if
